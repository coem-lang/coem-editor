{"mappings":"oeAAA,IAAAA,EAAAC,EAAA,SAEiBC,SAASC,iBAAiB,uBAA3C,MACEC,EAAaF,SAASG,cAAc,WACpCC,EAAcJ,SAASG,cAAc,YAKrCE,GAJgBL,SAASG,cAAc,sBAC5BH,SAASG,cAAc,eACxBH,SAASC,iBAAiB,qBAC3BD,SAASG,cAAc,WACnBH,SAASG,cAAc,gBACtC,IAGEG,EAAS,GAsFX,SAASC,EAAYC,EAAGC,EAAS,IAC/B,IAAKD,EAEH,OADAJ,EAAYM,UAAY,GACjB,KAETC,QAAQC,MAAMJ,GACd,MAzGFK,SAyGUA,EAzGVC,gBAyGoBA,EAzGpBC,aAyGqCA,EAzGrCC,iBAyGmDA,GAAqBC,gBAAgBT,EAAGC,GACzF,IAAIS,EAAWL,EACXE,IACFG,GAAY,SACZA,GAAY,GAAGJ,wBAAsCC,WAAsBC,KAE7EZ,EAAYM,UAAYQ,EAG1B,SAASC,EAAaC,GACpBd,GAAUc,EAAM,KAChBT,QAAQU,IAAID,GACZlB,EAAWQ,UAAYJ,EAGzB,SAASgB,IAEP,MAAMb,EAASX,EAAAyB,KAAKC,MAAMC,IAAIC,WAC9Bf,QAAQU,IAAIZ,GACZ,MAAMkB,EAAa,IAAIC,YACvBtB,EAAS,GACT,IACEuB,IAAIpB,EAAQkB,EAAYR,GACxBZ,EAAY,MACZ,MAAOC,GACPD,EAAYC,EAAGC,IAMnBT,SAAS8B,iBAAiB,oBAAoB,KAe5CzB,EAAWyB,iBAAiB,QAASR","sources":["src/js/scripts.js"],"sourcesContent":["import { view } from './codemirror/setup.js';\n\nconst menuBtns = document.querySelectorAll(\".nav__item > button\"),\n  outputArea = document.querySelector(\".output\"),\n  consoleArea = document.querySelector(\".console\"),\n  filenameTitle = document.querySelector(\"h2 .filename-title\"),\n  tocItems = document.querySelector(\".toc__items\"),\n  tocBtns = document.querySelectorAll(\".toc__item button\"),\n  newBtn = document.querySelector(\"#newBtn\"),\n  reflectBtn = document.querySelector(\"#reflectBtn\");\nlet editor,\n  isMenuOpen = false,\n  currentTitle = \"Untitled\",\n  output = \"\";\n\n// MENU\n\nfunction onMenuBtnClick(e) {\n  e.preventDefault();\n  let btn = e.currentTarget;\n  isMenuOpen = btn.parentElement.classList.toggle(\"nav__item--open\");\n}\n\nfunction onMenuBtnMouseover(e) {\n  e.preventDefault();\n  let btn = e.currentTarget;\n  if (isMenuOpen) {\n    for (let b of menuBtns) {\n      b.parentElement.classList.remove(\"nav__item--open\");\n    }\n    btn.parentElement.classList.add(\"nav__item--open\");\n    btn.focus();\n  }\n}\n\nfunction onMenuBtnBlur(e) {\n  // e.preventDefault();\n  // let btn = e.currentTarget;\n  // btn.parentElement.classList.remove(\"nav__item--open\");\n}\n\nfunction onNewBtnClick(e) {\n  e.preventDefault();\n  let btn = e.currentTarget;\n  btn.parentElement.parentElement.parentElement.classList.remove(\"nav__item--open\");\n  isMenuOpen = false;\n  createNewFile();\n}\n\nfunction clear() {\n  view.dispatch({\n    changes: {from: 0, to: view.state.doc.length, insert: \"\"}\n  });\n  outputArea.innerHTML = \"\";\n  for (let btn of tocBtns) {\n    btn.parentElement.classList.remove(\"current\");\n  }\n}\n\nfunction createNewFile() {\n  clear();\n  let tocItem = document.querySelector(\".toc__item\").cloneNode(true);\n  filenameTitle.innerHTML = \"Untitled\";\n  currentTitle = filenameTitle;\n  tocItem.querySelector(\".filename-title\").innerHTML = \"Untitled\";\n  tocItems.appendChild(tocItem);\n}\n\n// TOC\n\nfunction onTocBtnClick(e) {\n  e.preventDefault();\n  let filename = e.target.value;\n  load(filename);\n}\n\n// LOAD\n\nfunction load(filename) {\n  Promise.all([\n    fetch(\"/examples/\" + filename + \".coem\"),\n    fetch(\"/examples/\" + filename + \".output\")\n  ])\n  .then(results => Promise.all(results.map(r => r.text())))\n  .then(([coem, output]) => {\n    editor.getDoc().setValue(coem);\n    outputArea.innerHTML = output;\n    filenameTitle.innerHTML = filename;\n    currentTitle = filenameTitle;\n    for (let btn of tocBtns) {\n      btn.parentElement.classList.remove(\"current\");\n    }\n    document.querySelector(\"button[value=\\\"\" + filename + \"\\\"]\").parentElement.classList.add(\"current\");\n  })\n  .catch(err => console.log(err));\n}\n\n// REFLECT\n\nfunction handleError(e, source = \"\") {\n  if (!e) {\n    consoleArea.innerHTML = \"\";\n    return null;\n  }\n  console.error(e);\n  const { oneLiner, preErrorSection, errorSection, postErrorSection } = formatCoemError(e, source);\n  let errorStr = oneLiner;\n  if (errorSection) {\n    errorStr += '<br />';\n    errorStr += `${preErrorSection}<span class=\"error\">${errorSection}</span>${postErrorSection}`;\n  }\n  consoleArea.innerHTML = errorStr;\n}\n\nfunction handleOutput(txt) {\n  output += txt + '\\n';\n  console.log(txt);\n  outputArea.innerHTML = output;\n}\n\nfunction reflect() {\n  // https://github.com/danman113/YALI.js/blob/master/browser.js\n  const source = view.state.doc.toString();\n  console.log(source);\n  const browserEnv = new Environment();\n  output = \"\";\n  try {\n    run(source, browserEnv, handleOutput);\n    handleError(null);\n  } catch (e) {\n    handleError(e, source);\n  }\n}\n\n// MAIN\n\ndocument.addEventListener(\"DOMContentLoaded\", () => {\n  // load(\"Looking\");\n\n  // menuBtns.forEach(button => {\n  //   button.addEventListener(\"click\", onMenuBtnClick);\n  //   button.addEventListener(\"mouseover\", onMenuBtnMouseover);\n  //   button.addEventListener(\"blur\", onMenuBtnBlur);\n  // });\n\n  // newBtn.addEventListener(\"click\", onNewBtnClick);\n  \n  // tocBtns.forEach(btn => {\n  //   btn.addEventListener(\"click\", onTocBtnClick);\n  // });\n\n  reflectBtn.addEventListener(\"click\", reflect);\n});"],"names":["$8BrLS","parcelRequire","document","querySelectorAll","$c5788eb2e609bbc3$var$outputArea","querySelector","$c5788eb2e609bbc3$var$consoleArea","$c5788eb2e609bbc3$var$reflectBtn","$c5788eb2e609bbc3$var$output","$c5788eb2e609bbc3$var$handleError","e","source","innerHTML","console","error","oneLiner","preErrorSection","errorSection","postErrorSection","formatCoemError","errorStr","$c5788eb2e609bbc3$var$handleOutput","txt","log","$c5788eb2e609bbc3$var$reflect","view","state","doc","toString","browserEnv","Environment","run","addEventListener"],"version":3,"file":"index.f26bcf0a.js.map"}